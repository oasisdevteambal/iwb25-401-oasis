<!DOCTYPE html>
<html>

<head>
    <title>Debug Document Upload Test</title>
</head>

<body>
    <h1>Debug Document Upload Test</h1>

    <form id="uploadForm" action="http://localhost:5000/api/v1/documents/upload" method="post"
        enctype="multipart/form-data">
        <label for="file">Select PDF file:</label><br>
        <input type="file" id="file" name="file" accept=".pdf,.doc,.docx"><br><br>
        <input type="submit" value="Upload">
    </form>

    <div id="result"></div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = new FormData();
            const fileInput = document.getElementById('file');
            formData.append('file', fileInput.files[0]);

            try {
                console.log('Uploading file...');
                const uploadResponse = await fetch('http://localhost:5000/api/v1/documents/upload', {
                    method: 'POST',
                    body: formData
                });

                const uploadResult = await uploadResponse.json();
                console.log('Upload result:', uploadResult);

                if (uploadResult.success) {
                    document.getElementById('result').innerHTML = '<p>Upload successful! Document ID: ' + uploadResult.document.id + '</p>';

                    // Now process the document to see Java debug output
                    console.log('Processing document...');
                    const processResponse = await fetch('http://localhost:5000/api/v1/documents/process/' + uploadResult.document.id, {
                        method: 'POST'
                    });

                    const processResult = await processResponse.json();
                    console.log('Process result:', processResult);

                    document.getElementById('result').innerHTML += '<p>Processing completed!</p><pre>' + JSON.stringify(processResult, null, 2) + '</pre>';
                } else {
                    document.getElementById('result').innerHTML = '<p>Upload failed: ' + uploadResult.message + '</p>';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = '<p>Error: ' + error.message + '</p>';
            }
        });
    </script>
</body>

</html>